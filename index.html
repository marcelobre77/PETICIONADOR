<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Peti√ß√µes Jur√≠dicas</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a more professional look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to start, not center vertically */
            min-height: 100vh;
            padding: 2rem 1rem; /* Add padding for small screens */
        }
        .container {
            max-width: 960px; /* Slightly wider container */
            width: 100%;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Stronger shadow for depth */
            border-radius: 1rem; /* More rounded corners for the main container */
        }
        .card {
            @apply bg-white p-8 rounded-xl shadow-lg mb-6 border border-gray-100; /* Enhanced card styling */
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-2px); /* Slight lift on hover */
        }
        .form-label {
            @apply block text-sm font-medium text-gray-800 mb-1; /* Darker text for labels */
        }
        /* New style for highlighted labels */
        .highlighted-label {
            @apply bg-blue-800 text-white font-bold py-1 px-3 rounded-md inline-block mb-1; /* Navy background, white bold text, padding, rounded */
        }
        .form-input, .form-select, .form-textarea {
            @apply mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-600 focus:ring-blue-600 sm:text-base p-3 transition duration-150 ease-in-out; /* Larger padding, blue focus ring, rounded */
            background-color: #f9fafb; /* Light background for inputs */
        }
        .btn-primary {
            @apply inline-flex items-center px-8 py-4 border border-transparent text-base font-semibold rounded-lg shadow-md text-white bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:scale-105; /* Gradient, larger, bolder, scale on hover */
        }
        #copyToClipboardBtn {
            @apply bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 focus:ring-green-500; /* Green gradient for copy button */
        }
        #errorMessageCard {
            @apply bg-red-50 p-4 rounded-lg border border-red-300 text-red-800; /* Softer red for errors */
        }
    </style>
</head>
<body class="p-4">
    <div class="container mx-auto">
        <h1 class="text-5xl font-extrabold text-center text-gray-900 mb-2 leading-tight">
            ‚úçÔ∏è Gerador Inteligente de Peti√ß√µes Jur√≠dicas
        </h1>
        <p class="text-center text-gray-600 text-lg italic mb-10">Uma cria√ß√£o de Marcelo Brendon</p>

        <!-- Requester Data Card -->
        <div class="card">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <span class="mr-3">üë§</span> Dados do Requerente
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="requerenteNome" class="highlighted-label">Nome Completo</label>
                    <input type="text" id="requerenteNome" class="form-input" placeholder="Seu nome completo">
                </div>
                <div>
                    <label for="requerenteEstadoCivil" class="highlighted-label">Estado Civil</label>
                    <input type="text" id="requerenteEstadoCivil" class="form-input" placeholder="Ex: Solteiro(a), Casado(a)">
                </div>
                <div>
                    <label for="requerenteProfissao" class="highlighted-label">Profiss√£o</label>
                    <input type="text" id="requerenteProfissao" class="form-input" placeholder="Sua profiss√£o">
                </div>
                <div>
                    <label for="requerenteCPF" class="highlighted-label">CPF</label>
                    <input type="text" id="requerenteCPF" class="form-input" placeholder="000.000.000-00">
                </div>
                <div>
                    <label for="requerenteEmail" class="highlighted-label">Email</label>
                    <input type="email" id="requerenteEmail" class="form-input" placeholder="seu.email@example.com">
                </div>
                <div>
                    <label for="requerenteResidencia" class="highlighted-label">Endere√ßo de Resid√™ncia</label>
                    <input type="text" id="requerenteResidencia" class="form-input" placeholder="Rua, N√∫mero, Bairro, Cidade, Estado">
                </div>
            </div>
        </div>

        <!-- Respondent Data Card -->
        <div class="card">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <span class="mr-3">‚öñÔ∏è</span> Dados do Requerido
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="requeridoNome" class="highlighted-label">Nome/Raz√£o Social</label>
                    <input type="text" id="requeridoNome" class="form-input" placeholder="Nome completo ou Raz√£o Social">
                </div>
                <div>
                    <label for="requeridoCPFCNPJ" class="highlighted-label">CPF ou CNPJ</label>
                    <input type="text" id="requeridoCPFCNPJ" class="form-input" placeholder="000.000.000-00 ou 00.000.000/0000-00">
                </div>
                <div class="md:col-span-2">
                    <label for="requeridoEndereco" class="highlighted-label">Endere√ßo Completo</label>
                    <input type="text" id="requeridoEndereco" class="form-input" placeholder="Rua, N√∫mero, Bairro, Cidade, Estado">
                </div>
            </div>
        </div>

        <!-- Petition Type and Demand Summary Card -->
        <div class="card">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <span class="mr-3">üìÑ</span> Detalhes da Peti√ß√£o
            </h2>
            <div class="mb-6">
                <label for="tipoPeticao" class="form-label">Tipo de Peti√ß√£o</label>
                <select id="tipoPeticao" class="form-select">
                    <option value="">Selecione o tipo de peti√ß√£o</option>
                    <option value="A√ß√£o de Dano Moral">A√ß√£o de Dano Moral</option>
                    <option value="Recurso Inominado">Recurso Inominado</option>
                    <option value="A√ß√£o de Dano Material">A√ß√£o de Dano Material</option>
                </select>
            </div>
            <div>
                <label for="resumoDemanda" class="form-label">Resumo da Demanda</label>
                <textarea id="resumoDemanda" rows="10" class="form-textarea" placeholder="Descreva de forma clara e concisa os fatos e o que voc√™ busca com esta peti√ß√£o. Quanto mais detalhes, melhor a IA ser√°."></textarea>
            </div>
        </div>

        <!-- Generate Button -->
        <div class="text-center mb-8">
            <button id="gerarPeticaoBtn" class="btn-primary">
                <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white hidden" id="loadingSpinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Gerar Peti√ß√£o
            </button>
        </div>

        <!-- Generated Petition Display Area -->
        <div class="card hidden" id="peticaoGeradaCard">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center">
                <span class="mr-3">üìù</span> Peti√ß√£o Gerada
            </h2>
            <div id="peticaoGerada" class="bg-gray-50 p-6 rounded-md border border-gray-200 whitespace-pre-wrap text-gray-800 text-base leading-relaxed overflow-auto max-h-96">
                <!-- Petition content will be loaded here -->
            </div>
             <div class="mt-6 text-center">
                <button id="copyToClipboardBtn" class="btn-primary">
                    <span class="mr-2">üìã</span> Copiar para √Årea de Transfer√™ncia
                </button>
            </div>
        </div>

        <!-- Error Message Area -->
        <div class="card hidden" id="errorMessageCard">
            <p id="errorMessage" class="font-bold text-lg flex items-center">
                <span class="mr-3 text-2xl">‚ùå</span>
            </p>
        </div>
    </div>

    <script type="module">
        // Get references to DOM elements
        const gerarPeticaoBtn = document.getElementById('gerarPeticaoBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const peticaoGeradaCard = document.getElementById('peticaoGeradaCard');
        const peticaoGerada = document.getElementById('peticaoGerada');
        const errorMessageCard = document.getElementById('errorMessageCard');
        const errorMessage = document.getElementById('errorMessage');
        const copyToClipboardBtn = document.getElementById('copyToClipboardBtn');

        // Event listener for the "Generate Petition" button
        gerarPeticaoBtn.addEventListener('click', async () => {
            // Clear previous messages and hide output
            peticaoGeradaCard.classList.add('hidden');
            errorMessageCard.classList.add('hidden');
            peticaoGerada.textContent = '';
            errorMessage.textContent = '';

            // Collect form data
            const requerente = {
                nome: document.getElementById('requerenteNome').value,
                estadoCivil: document.getElementById('requerenteEstadoCivil').value,
                profissao: document.getElementById('requerenteProfissao').value,
                cpf: document.getElementById('requerenteCPF').value,
                email: document.getElementById('requerenteEmail').value,
                residencia: document.getElementById('requerenteResidencia').value,
            };

            const requerido = {
                nome: document.getElementById('requeridoNome').value,
                cpfCnpj: document.getElementById('requeridoCPFCNPJ').value,
                endereco: document.getElementById('requeridoEndereco').value,
            };

            const tipoPeticao = document.getElementById('tipoPeticao').value;
            const resumoDemanda = document.getElementById('resumoDemanda').value;

            // Basic validation
            if (!requerente.nome || !requerido.nome || !tipoPeticao || !resumoDemanda) {
                errorMessage.innerHTML = '<span class="mr-3 text-2xl">‚ö†Ô∏è</span> Por favor, preencha todos os campos obrigat√≥rios: Nome do Requerente, Nome do Requerido, Tipo de Peti√ß√£o e Resumo da Demanda.';
                errorMessageCard.classList.remove('hidden');
                return;
            }

            // Construct the prompt for the AI
            const prompt = `
                Gere uma peti√ß√£o jur√≠dica do tipo "${tipoPeticao}" com base nos seguintes dados e no resumo da demanda.
                A peti√ß√£o deve ser formal, estruturada como um documento legal e em portugu√™s do Brasil.

                ---
                Dados do Requerente:
                Nome Completo: ${requerente.nome || 'N√£o Informado'}
                Estado Civil: ${requerente.estadoCivil || 'N√£o Informado'}
                Profiss√£o: ${requerente.profissao || 'N√£o Informada'}
                CPF: ${requerente.cpf || 'N√£o Informado'}
                Email: ${requerente.email || 'N√£o Informado'}
                Endere√ßo de Resid√™ncia: ${requerente.residencia || 'N√£o Informado'}

                Dados do Requerido:
                Nome/Raz√£o Social: ${requerido.nome || 'N√£o Informado'}
                CPF ou CNPJ: ${requerido.cpfCnpj || 'N√£o Informado'}
                Endere√ßo Completo: ${requerido.endereco || 'N√£o Informado'}

                Resumo da Demanda:
                ${resumoDemanda}
                ---

                A peti√ß√£o deve seguir a estrutura de:
                1.  **Excelent√≠ssimo(a) Senhor(a) Doutor(a) Juiz(a) de Direito da [Vara/Comarca, se aplic√°vel, sen√£o deixar gen√©rico]**
                2.  **Qualifica√ß√£o das Partes:** Detalhar requerente e requerido com os dados fornecidos.
                3.  **Dos Fatos:** Expor o resumo da demanda de forma clara e objetiva.
                4.  **Do Direito:** Apresentar a fundamenta√ß√£o jur√≠dica (cite artigos do C√≥digo Civil ou de Processo Civil, princ√≠pios jur√≠dicos aplic√°veis como "Dignidade da Pessoa Humana", "Boa-f√© Objetiva", "Fun√ß√£o Social do Contrato", "Repara√ß√£o de Danos", "Responsabilidade Civil", etc., de forma gen√©rica se n√£o houver cita√ß√£o espec√≠fica no resumo). Para Recurso Inominado, abordar a admissibilidade e o m√©rito.
                5.  **Dos Pedidos:** Formular os pedidos espec√≠ficos (condena√ß√£o em danos morais, materiais, anula√ß√£o de senten√ßa, etc.). Incluir pedido de cita√ß√£o do requerido, produ√ß√£o de provas, e justi√ßa gratuita se for o caso.
                6.  **Valor da Causa:** Sugerir um valor simb√≥lico ou deixar espa√ßo para preenchimento.
                7.  **Fechamento:** "Nestes termos, pede deferimento. [Cidade], [Dia] de [M√™s] de [Ano]. [Nome do Advogado/Requerente, OAB (se aplic√°vel)]"

                A peti√ß√£o deve ser um texto cont√≠nuo e bem formatado, como um documento final. N√£o adicione coment√°rios de c√≥digo ou marcadores que n√£o sejam parte da peti√ß√£o em si.
            `;

            // Show loading spinner and disable button
            loadingSpinner.classList.remove('hidden');
            gerarPeticaoBtn.disabled = true;

            try {
                // Call the Gemini API
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error Response:', errorData); // Log full error response
                    throw new Error(`Erro na comunica√ß√£o com a IA: ${errorData.error?.message || response.statusText}. Por favor, tente novamente.`);
                }

                const result = await response.json();
                console.log('AI Response Result:', result); // Log full successful result

                // Check for generated content
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    if (generatedText && generatedText.trim().length > 0) {
                        peticaoGerada.textContent = generatedText;
                        peticaoGeradaCard.classList.remove('hidden');
                    } else {
                        errorMessage.innerHTML = 'N√£o foi poss√≠vel gerar a peti√ß√£o. A intelig√™ncia artificial n√£o retornou conte√∫do. Tente refinar o resumo da demanda.';
                        errorMessageCard.classList.remove('hidden');
                    }
                } else {
                    errorMessage.innerHTML = 'A intelig√™ncia artificial n√£o retornou uma resposta v√°lida. Isso pode ocorrer se o resumo da demanda for muito vago ou sens√≠vel. Por favor, revise e tente novamente.';
                    errorMessageCard.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Erro ao gerar peti√ß√£o:', error);
                errorMessage.innerHTML = `<span class="mr-3 text-2xl">üö®</span> Ocorreu um erro inesperado: ${error.message}. Verifique sua conex√£o e tente novamente.`;
                errorMessageCard.classList.remove('hidden');
            } finally {
                // Hide loading spinner and enable button
                loadingSpinner.classList.add('hidden');
                gerarPeticaoBtn.disabled = false;
            }
        });

        // Event listener for the "Copy to Clipboard" button
        copyToClipboardBtn.addEventListener('click', () => {
            const textToCopy = peticaoGerada.textContent;
            try {
                // Use execCommand for broader compatibility in iframes
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                // Optionally, show a temporary success message
                copyToClipboardBtn.innerHTML = '<span class="mr-2">‚úÖ</span> Copiado!';
                setTimeout(() => {
                    copyToClipboardBtn.innerHTML = '<span class="mr-2">üìã</span> Copiar para √Årea de Transfer√™ncia';
                }, 2000);

            } catch (err) {
                console.error('Falha ao copiar texto: ', err);
                // Fallback for older browsers or if execCommand fails
                copyToClipboardBtn.innerHTML = '<span class="mr-2">‚ùå</span> Erro ao Copiar!';
                setTimeout(() => {
                    copyToClipboardBtn.innerHTML = '<span class="mr-2">üìã</span> Copiar para √Årea de Transfer√™ncia';
                }, 2000);
            }
        });
    </script>
</body>
</html>